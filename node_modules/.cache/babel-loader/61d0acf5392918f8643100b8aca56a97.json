{"ast":null,"code":"/**\n * 循环左移\n */\nfunction rotl(x, n) {\n  var result = [];\n  var a = ~~(n / 8); // 偏移 a 字节\n\n  var b = n % 8; // 偏移 b 位\n\n  for (var i = 0, len = x.length; i < len; i++) {\n    // current << b + (current + 1) >>> (8 - b)\n    result[i] = (x[(i + a) % len] << b & 0xff) + (x[(i + a + 1) % len] >>> 8 - b & 0xff);\n  }\n\n  return result;\n}\n/**\n * 二进制异或运算\n */\n\n\nfunction xor(x, y) {\n  var result = [];\n\n  for (var i = x.length - 1; i >= 0; i--) result[i] = (x[i] ^ y[i]) & 0xff;\n\n  return result;\n}\n/**\n * 二进制与运算\n */\n\n\nfunction and(x, y) {\n  var result = [];\n\n  for (var i = x.length - 1; i >= 0; i--) result[i] = x[i] & y[i] & 0xff;\n\n  return result;\n}\n/**\n * 二进制或运算\n */\n\n\nfunction or(x, y) {\n  var result = [];\n\n  for (var i = x.length - 1; i >= 0; i--) result[i] = (x[i] | y[i]) & 0xff;\n\n  return result;\n}\n/**\n * 二进制与运算\n */\n\n\nfunction add(x, y) {\n  var result = [];\n  var temp = 0;\n\n  for (var i = x.length - 1; i >= 0; i--) {\n    var sum = x[i] + y[i] + temp;\n\n    if (sum > 0xff) {\n      temp = 1;\n      result[i] = sum & 0xff;\n    } else {\n      temp = 0;\n      result[i] = sum & 0xff;\n    }\n  }\n\n  return result;\n}\n/**\n * 二进制非运算\n */\n\n\nfunction not(x) {\n  var result = [];\n\n  for (var i = x.length - 1; i >= 0; i--) result[i] = ~x[i] & 0xff;\n\n  return result;\n}\n/**\n * 压缩函数中的置换函数 P1(X) = X xor (X <<< 9) xor (X <<< 17)\n */\n\n\nfunction P0(X) {\n  return xor(xor(X, rotl(X, 9)), rotl(X, 17));\n}\n/**\n * 消息扩展中的置换函数 P1(X) = X xor (X <<< 15) xor (X <<< 23)\n */\n\n\nfunction P1(X) {\n  return xor(xor(X, rotl(X, 15)), rotl(X, 23));\n}\n/**\n * 布尔函数 FF\n */\n\n\nfunction FF(X, Y, Z, j) {\n  return j >= 0 && j <= 15 ? xor(xor(X, Y), Z) : or(or(and(X, Y), and(X, Z)), and(Y, Z));\n}\n/**\n * 布尔函数 GG\n */\n\n\nfunction GG(X, Y, Z, j) {\n  return j >= 0 && j <= 15 ? xor(xor(X, Y), Z) : or(and(X, Y), and(not(X), Z));\n}\n/**\n * 压缩函数\n */\n\n\nfunction CF(V, Bi) {\n  // 消息扩展\n  var W = [];\n  var M = []; // W'\n  // 将消息分组B划分为 16 个字 W0， W1，……，W15\n\n  for (var i = 0; i < 16; i++) {\n    var start = i * 4;\n    W.push(Bi.slice(start, start + 4));\n  } // W16 ～ W67：W[j] <- P1(W[j−16] xor W[j−9] xor (W[j−3] <<< 15)) xor (W[j−13] <<< 7) xor W[j−6]\n\n\n  for (var j = 16; j < 68; j++) {\n    W.push(xor(xor(P1(xor(xor(W[j - 16], W[j - 9]), rotl(W[j - 3], 15))), rotl(W[j - 13], 7)), W[j - 6]));\n  } // W′0 ～ W′63：W′[j] = W[j] xor W[j+4]\n\n\n  for (var j = 0; j < 64; j++) {\n    M.push(xor(W[j], W[j + 4]));\n  } // 压缩\n\n\n  var T1 = [0x79, 0xcc, 0x45, 0x19];\n  var T2 = [0x7a, 0x87, 0x9d, 0x8a]; // 字寄存器\n\n  var A = V.slice(0, 4);\n  var B = V.slice(4, 8);\n  var C = V.slice(8, 12);\n  var D = V.slice(12, 16);\n  var E = V.slice(16, 20);\n  var F = V.slice(20, 24);\n  var G = V.slice(24, 28);\n  var H = V.slice(28, 32); // 中间变量\n\n  var SS1;\n  var SS2;\n  var TT1;\n  var TT2;\n\n  for (var j = 0; j < 64; j++) {\n    var T = j >= 0 && j <= 15 ? T1 : T2;\n    SS1 = rotl(add(add(rotl(A, 12), E), rotl(T, j)), 7);\n    SS2 = xor(SS1, rotl(A, 12));\n    TT1 = add(add(add(FF(A, B, C, j), D), SS2), M[j]);\n    TT2 = add(add(add(GG(E, F, G, j), H), SS1), W[j]);\n    D = C;\n    C = rotl(B, 9);\n    B = A;\n    A = TT1;\n    H = G;\n    G = rotl(F, 19);\n    F = E;\n    E = P0(TT2);\n  }\n\n  return xor([].concat(A, B, C, D, E, F, G, H), V);\n}\n\nexport default function sm3(array) {\n  // 填充\n  var len = array.length * 8; // k 是满足 len + 1 + k = 448mod512 的最小的非负整数\n\n  var k = len % 512; // 如果 448 <= (512 % len) < 512，需要多补充 (len % 448) 比特'0'以满足总比特长度为512的倍数\n\n  k = k >= 448 ? 512 - k % 448 - 1 : 448 - k - 1; // 填充\n\n  var kArr = new Array((k - 7) / 8);\n\n  for (var i = 0, len_1 = kArr.length; i < len_1; i++) kArr[i] = 0;\n\n  var lenArr = [];\n  len = len.toString(2);\n\n  for (var i = 7; i >= 0; i--) {\n    if (len.length > 8) {\n      var start = len.length - 8;\n      lenArr[i] = parseInt(len.substr(start), 2);\n      len = len.substr(0, start);\n    } else if (len.length > 0) {\n      lenArr[i] = parseInt(len, 2);\n      len = '';\n    } else {\n      lenArr[i] = 0;\n    }\n  }\n\n  var m = [].concat(array, [0x80], kArr, lenArr); // 迭代压缩\n\n  var n = m.length / 64;\n  var V = [0x73, 0x80, 0x16, 0x6f, 0x49, 0x14, 0xb2, 0xb9, 0x17, 0x24, 0x42, 0xd7, 0xda, 0x8a, 0x06, 0x00, 0xa9, 0x6f, 0x30, 0xbc, 0x16, 0x31, 0x38, 0xaa, 0xe3, 0x8d, 0xee, 0x4d, 0xb0, 0xfb, 0x0e, 0x4e];\n\n  for (var i = 0; i < n; i++) {\n    var start = 64 * i;\n    var B = m.slice(start, start + 64);\n    V = CF(V, B);\n  }\n\n  return V;\n}","map":{"version":3,"sources":["../../../../../src/lib/sm-crypto/sm2/sm3.js"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["/**\n * 循环左移\n */\nfunction rotl(x, n) {\n    var result = [];\n    var a = ~~(n / 8); // 偏移 a 字节\n    var b = n % 8; // 偏移 b 位\n    for (var i = 0, len = x.length; i < len; i++) {\n        // current << b + (current + 1) >>> (8 - b)\n        result[i] = ((x[(i + a) % len] << b) & 0xff) + ((x[(i + a + 1) % len] >>> (8 - b)) & 0xff);\n    }\n    return result;\n}\n/**\n * 二进制异或运算\n */\nfunction xor(x, y) {\n    var result = [];\n    for (var i = x.length - 1; i >= 0; i--)\n        result[i] = (x[i] ^ y[i]) & 0xff;\n    return result;\n}\n/**\n * 二进制与运算\n */\nfunction and(x, y) {\n    var result = [];\n    for (var i = x.length - 1; i >= 0; i--)\n        result[i] = (x[i] & y[i]) & 0xff;\n    return result;\n}\n/**\n * 二进制或运算\n */\nfunction or(x, y) {\n    var result = [];\n    for (var i = x.length - 1; i >= 0; i--)\n        result[i] = (x[i] | y[i]) & 0xff;\n    return result;\n}\n/**\n * 二进制与运算\n */\nfunction add(x, y) {\n    var result = [];\n    var temp = 0;\n    for (var i = x.length - 1; i >= 0; i--) {\n        var sum = x[i] + y[i] + temp;\n        if (sum > 0xff) {\n            temp = 1;\n            result[i] = sum & 0xff;\n        }\n        else {\n            temp = 0;\n            result[i] = sum & 0xff;\n        }\n    }\n    return result;\n}\n/**\n * 二进制非运算\n */\nfunction not(x) {\n    var result = [];\n    for (var i = x.length - 1; i >= 0; i--)\n        result[i] = (~x[i]) & 0xff;\n    return result;\n}\n/**\n * 压缩函数中的置换函数 P1(X) = X xor (X <<< 9) xor (X <<< 17)\n */\nfunction P0(X) {\n    return xor(xor(X, rotl(X, 9)), rotl(X, 17));\n}\n/**\n * 消息扩展中的置换函数 P1(X) = X xor (X <<< 15) xor (X <<< 23)\n */\nfunction P1(X) {\n    return xor(xor(X, rotl(X, 15)), rotl(X, 23));\n}\n/**\n * 布尔函数 FF\n */\nfunction FF(X, Y, Z, j) {\n    return j >= 0 && j <= 15 ? xor(xor(X, Y), Z) : or(or(and(X, Y), and(X, Z)), and(Y, Z));\n}\n/**\n * 布尔函数 GG\n */\nfunction GG(X, Y, Z, j) {\n    return j >= 0 && j <= 15 ? xor(xor(X, Y), Z) : or(and(X, Y), and(not(X), Z));\n}\n/**\n * 压缩函数\n */\nfunction CF(V, Bi) {\n    // 消息扩展\n    var W = [];\n    var M = []; // W'\n    // 将消息分组B划分为 16 个字 W0， W1，……，W15\n    for (var i = 0; i < 16; i++) {\n        var start = i * 4;\n        W.push(Bi.slice(start, start + 4));\n    }\n    // W16 ～ W67：W[j] <- P1(W[j−16] xor W[j−9] xor (W[j−3] <<< 15)) xor (W[j−13] <<< 7) xor W[j−6]\n    for (var j = 16; j < 68; j++) {\n        W.push(xor(xor(P1(xor(xor(W[j - 16], W[j - 9]), rotl(W[j - 3], 15))), rotl(W[j - 13], 7)), W[j - 6]));\n    }\n    // W′0 ～ W′63：W′[j] = W[j] xor W[j+4]\n    for (var j = 0; j < 64; j++) {\n        M.push(xor(W[j], W[j + 4]));\n    }\n    // 压缩\n    var T1 = [0x79, 0xcc, 0x45, 0x19];\n    var T2 = [0x7a, 0x87, 0x9d, 0x8a];\n    // 字寄存器\n    var A = V.slice(0, 4);\n    var B = V.slice(4, 8);\n    var C = V.slice(8, 12);\n    var D = V.slice(12, 16);\n    var E = V.slice(16, 20);\n    var F = V.slice(20, 24);\n    var G = V.slice(24, 28);\n    var H = V.slice(28, 32);\n    // 中间变量\n    var SS1;\n    var SS2;\n    var TT1;\n    var TT2;\n    for (var j = 0; j < 64; j++) {\n        var T = j >= 0 && j <= 15 ? T1 : T2;\n        SS1 = rotl(add(add(rotl(A, 12), E), rotl(T, j)), 7);\n        SS2 = xor(SS1, rotl(A, 12));\n        TT1 = add(add(add(FF(A, B, C, j), D), SS2), M[j]);\n        TT2 = add(add(add(GG(E, F, G, j), H), SS1), W[j]);\n        D = C;\n        C = rotl(B, 9);\n        B = A;\n        A = TT1;\n        H = G;\n        G = rotl(F, 19);\n        F = E;\n        E = P0(TT2);\n    }\n    return xor([].concat(A, B, C, D, E, F, G, H), V);\n}\nexport default function sm3(array) {\n    // 填充\n    var len = array.length * 8;\n    // k 是满足 len + 1 + k = 448mod512 的最小的非负整数\n    var k = len % 512;\n    // 如果 448 <= (512 % len) < 512，需要多补充 (len % 448) 比特'0'以满足总比特长度为512的倍数\n    k = k >= 448 ? 512 - (k % 448) - 1 : 448 - k - 1;\n    // 填充\n    var kArr = new Array((k - 7) / 8);\n    for (var i = 0, len_1 = kArr.length; i < len_1; i++)\n        kArr[i] = 0;\n    var lenArr = [];\n    len = len.toString(2);\n    for (var i = 7; i >= 0; i--) {\n        if (len.length > 8) {\n            var start = len.length - 8;\n            lenArr[i] = parseInt(len.substr(start), 2);\n            len = len.substr(0, start);\n        }\n        else if (len.length > 0) {\n            lenArr[i] = parseInt(len, 2);\n            len = '';\n        }\n        else {\n            lenArr[i] = 0;\n        }\n    }\n    var m = [].concat(array, [0x80], kArr, lenArr);\n    // 迭代压缩\n    var n = m.length / 64;\n    var V = [0x73, 0x80, 0x16, 0x6f, 0x49, 0x14, 0xb2, 0xb9, 0x17, 0x24, 0x42, 0xd7, 0xda, 0x8a, 0x06, 0x00, 0xa9, 0x6f, 0x30, 0xbc, 0x16, 0x31, 0x38, 0xaa, 0xe3, 0x8d, 0xee, 0x4d, 0xb0, 0xfb, 0x0e, 0x4e];\n    for (var i = 0; i < n; i++) {\n        var start = 64 * i;\n        var B = m.slice(start, start + 64);\n        V = CF(V, B);\n    }\n    return V;\n}\n//# sourceMappingURL=sm3.js.map"]},"metadata":{},"sourceType":"module"}