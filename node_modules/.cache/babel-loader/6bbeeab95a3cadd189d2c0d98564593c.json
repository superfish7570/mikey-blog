{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nimport { createCssClassStyleSheet } from '../utils';\nimport { BaseAuthenticationClient } from './BaseAuthenticationClient';\n/**\n * @class QrCodeAuthenticationClient 扫码登录模块\n * @description 此模块用于进行扫码登录，扫码登录分为两种小程序扫码登录（wxqrcode）和 APP 扫码登录（qrcode）。两种扫码登录方式 API 完全一致。\n *\n * 使用小程序扫码登录：\n *\n * \\`\\`\\`javascript\n * import { AuthenticationClient } from \"authing-js-sdk\"\n * const authenticationClient = new AuthenticationClient({\n *    appId: \"YOUR_APP_ID\",\n * })\n * authenticationClient.wxqrcode.startScanning() # 开始扫码登录\n * \\`\\`\\`\n *\n * 使用 APP 扫码登录\n *\n * \\`\\`\\`javascript\n * import { AuthenticationClient } from \"authing-js-sdk\"\n * const authenticationClient = new AuthenticationClient({\n *    appId: \"YOUR_APP_ID\",\n * })\n * authenticationClient.qrcode.startScanning() # 开始扫码登录\n * \\`\\`\\`\n *\n * @name QrCodeAuthenticationClient\n */\n\nvar roundedImage = function (context2D, x, y, width, height, radius) {\n  context2D.beginPath();\n  context2D.moveTo(x + radius, y);\n  context2D.lineTo(x + width - radius, y);\n  context2D.quadraticCurveTo(x + width, y, x + width, y + radius);\n  context2D.lineTo(x + width, y + height - radius);\n  context2D.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n  context2D.lineTo(x + radius, y + height);\n  context2D.quadraticCurveTo(x, y + height, x, y + height - radius);\n  context2D.lineTo(x, y + radius);\n  context2D.quadraticCurveTo(x, y, x + radius, y);\n  context2D.closePath();\n};\n\nvar getOffset = function (size) {\n  var containerHalfWidth = size.width / 2;\n  var containerHalfHeight = size.height / 2;\n  var ww = size.width / 2.4;\n  var hh = size.height / 2.4;\n  var logoHalfWidth = ww / 2;\n  var logoHalfHeight = hh / 2;\n  return {\n    x: containerHalfWidth - logoHalfWidth,\n    y: containerHalfHeight - logoHalfHeight,\n    ww: ww,\n    hh: hh\n  };\n};\n\nvar QrCodeAuthenticationClient =\n/** @class */\nfunction () {\n  function QrCodeAuthenticationClient(options, tokenProvider, httpClient, scene) {\n    this.options = options;\n    this.tokenProvider = tokenProvider;\n    this.httpClient = httpClient;\n    this.scene = scene;\n    this.baseClient = new BaseAuthenticationClient(options);\n  }\n  /**\n   * @name startScanning\n   * @name_zh 一键开始扫码\n   * @description 一键开始扫码\n   *\n   * @param {string} domId DOM 元素的 ID。\n   * @param {Object} options\n   * @param {boolean} options.autoExchangeUserInfo 是否自定义使用 ticket 换取用户信息\n   * @param {number} options.interval 间隔时间，单位为毫秒，默认为 800 毫秒\n   * @param {Function} options.onStart 开始轮询的事件回调函数, 第一个参数为 setInterval 返回的计时器，可以用 clearInterval 取消此计时器\n   * @param {Function} options.onResult 获取到二维码最新状态事件回调函数，第一个参数为的类型为 QRCodeStatus。\n   * @param {Function} options.onScanned 用户首次扫码事件回调函数。此时用户还没有授权，回调的用户信息中通仅包含昵称和头像，用作展示目的。\n   * 出于安全性考虑，默认情况下，userInfo 只会包含昵称（nickname）和头像（photo）两个字段，开发者也可以在后台配置使其返回完整用户信息，\n   * @param {Function} options.onSuccess 用户同意授权事件回调函数。该函数只会回调一次，之后轮询结束。第一个参数为 userInfo 用户信息，第二个参数为 ticket，用于换取用户的详情。\n   * 详情见 https://docs.authing.co/scan-qrcode/app-qrcode/customize.html。\n   * ticket 可以用来换取完整的用户信息，相关接口见 https://docs.authing.co/scan-qrcode/app-qrcode/full-api-list.html。\n   * @param {Function} options.onCancel 用户取消授权事件回调函数。该事件只会回调一次，之后轮询结束。\n   * @param {Function} options.onError 获取二维码状态失败事件回调函数。常见原因为网络失败等，每次查询失败时都会回调。回调参数 data 示例如 {\"code\": 2241,\"message\": \"二维码不存在\" }\n   * @param {Function} options.onExpired 二维码失效时被回调，只回调一次，之后轮询结束。\n   * @param {Function} options.onCodeShow 二维码首次成功显示的事件。\n   * @param {Function} options.onCodeLoaded 二维码首次成功 Load 的事件。\n   * @param {Function} options.onCodeLoadFailed 二维码加载失败的事件。\n   * @param {Function} options.onCodeDestroyed 二维码被销毁的事件。\n   * @param {string} options.extIdpConnId 多租户用的额外的 Idp Id。\n   * @param {Function} options.onRetry 二维码重试事件。\n   * @param {Object} options.size 二维码图片大小，默认为 240 * 240，单位为 px 。\n   * @param {number} options.size.height 高度\n   * @param {number} options.size.width 宽度\n   * @param {Object} options.containerSize DOM 容器大小，默认为 300 * 300，单位为 px 。\n   * @param {number} options.containerSize.height 高度\n   * @param {number} options.containerSize.width 宽度\n   * @param {Object} options.tips 自定义提示信息\n   * @param {number} options.tips.title\n   * @param {number} options.tips.scanned\n   * @param {Object} options.tips.succeed\n   * @param {number} options.tips.canceled\n   * @param {number} options.tips.expired\n   * @param {number} options.tips.retry\n   * @param {number} options.tips.failed\n   *\n   * @example\n   *\n   * authenticationClient.wxqrcode.startScanning(\"qrcode\", {\n   *  onSuccess: (userInfo, ticket) => {\n   *    console.log(userInfo, ticket)\n   *  },\n   *  onError: (message) => onFail && onFail(`${message}`),\n   * });\n   *\n   * @returns {null}\n   * @memberof QrCodeAuthenticationClient\n   *\n   */\n\n\n  QrCodeAuthenticationClient.prototype.startScanning = function (domId, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      function genRetry(qrcodeElm, tipText, retryId) {\n        return __awaiter(this, void 0, void 0, function () {\n          var tip, qrcodeImage, shadow, dom;\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                tip = genTip(tipText);\n                nodeWrapper = document.createElement('div');\n                nodeWrapper.id = 'authing__qrcode-wrapper';\n                nodeWrapper.style.textAlign = 'center';\n                nodeWrapper.style.position = 'relative';\n                return [4\n                /*yield*/\n                , genImage('https://usercontents.authing.cn/0ab3a1bf19c0d7106673e494d532f91a.png')];\n\n              case 1:\n                qrcodeImage = _a.sent();\n\n                if (!needGenerate) {\n                  qrcodeImage.style.marginTop = '12px';\n                } else {\n                  qrcodeImage.style.marginTop = '16px';\n                }\n\n                qrcodeImage.onload = function () {\n                  unloading();\n                };\n\n                shadow = genShadow(retry, function () {\n                  if (onRetry) {\n                    onRetry();\n                  }\n\n                  start();\n                }, retryId || '__authing_retry_btn');\n                nodeWrapper.appendChild(qrcodeImage);\n                nodeWrapper.appendChild(shadow);\n                nodeWrapper.appendChild(tip);\n                dom = document.querySelector('#authing__qrcode-wrapper');\n                if (dom) dom.remove();\n                qrcodeElm.appendChild(nodeWrapper);\n                return [2\n                /*return*/\n                ];\n            }\n          });\n        });\n      }\n\n      var _a, autoExchangeUserInfo, _b, size, _c, containerSize, _d, interval, onStart, onResult, onScanned, onExpired, onSuccess, onCancel, onError, onCodeShow, onCodeLoaded, onCodeLoadFailed, onRetry, onMfa, onAuthFlow, _e, // onCodeDestroyed,\n      tips, context, customData, extIdpConnId, withCustomData, lang, nowLang, _f, title, _g, // @ts-ignore\n      canceled, _h, expired, _j, succeed, _k, retry, _l, middleTitle, _m, referText, node, nodeWrapper, needGenerate, styleNode, style, loading, unloading, genTip, editTipText, genImage, genLogoInCenter, genShadowMiddleStatus, genReferTextNode, removeReferTextNode, genShadow, displayScannedUser, start;\n\n      var _this = this;\n\n      return __generator(this, function (_o) {\n        options = options || {};\n        _a = options.autoExchangeUserInfo, autoExchangeUserInfo = _a === void 0 ? false : _a, _b = options.size, size = _b === void 0 ? {\n          height: 240,\n          width: 240\n        } : _b, _c = options.containerSize, containerSize = _c === void 0 ? {\n          height: 300,\n          width: 300\n        } : _c, _d = options.interval, interval = _d === void 0 ? 800 : _d, onStart = options.onStart, onResult = options.onResult, onScanned = options.onScanned, onExpired = options.onExpired, onSuccess = options.onSuccess, onCancel = options.onCancel, onError = options.onError, onCodeShow = options.onCodeShow, onCodeLoaded = options.onCodeLoaded, onCodeLoadFailed = options.onCodeLoadFailed, onRetry = options.onRetry, onMfa = options.onMfa, onAuthFlow = options.onAuthFlow, _e = options.tips, tips = _e === void 0 ? {} : _e, context = options.context, customData = options.customData, extIdpConnId = options.extIdpConnId, withCustomData = options.withCustomData;\n        lang = this.options.lang;\n        nowLang = lang === 'zh-CN';\n        _f = tips.title, title = _f === void 0 ? nowLang ? \"\\u8BF7\\u5728\\u79FB\\u52A8\\u7AEF\\u786E\\u8BA4\\u8D26\\u53F7\\u767B\\u5F55\" : \"Please be on the mobile\" : _f, _g = tips.canceled, canceled = _g === void 0 ? nowLang ? '用户取消授权' : 'User cancel authorization' : _g, _h = tips.expired, expired = _h === void 0 ? nowLang ? '二维码已过期' : 'QR code has expired' : _h, _j = tips.succeed, succeed = _j === void 0 ? nowLang ? '扫码成功' : 'Scan code successfully' : _j, _k = tips.retry, retry = _k === void 0 ? nowLang ? '重试' : 'Retry' : _k, _l = tips.middleTitle, middleTitle = _l === void 0 ? nowLang ? '确认登录' : 'Confirm login' : _l, _m = tips.referText, referText = _m === void 0 ? nowLang ? '重新扫码' : 'Scan the code' : _m;\n        node = document.getElementById(domId);\n        needGenerate = false;\n\n        if (!node) {\n          node = document.createElement('div');\n          node.id = domId;\n          createCssClassStyleSheet('__authing-qrcode-node-mount', \"z-index: 65535;position: fixed;background: #fff;width: \" + containerSize.width + \"px;height: \" + containerSize.height + \"px;left: 50%;margin-left: -\" + containerSize.width / 2 + \"px;display: flex;justify-content: center;align-items: center;top: 50%;margin-top: -\" + containerSize.height / 2 + \"px;border: 1px solid #ccc;\");\n          node.classList.add('__authing-qrcode-node-mount');\n          document.getElementsByTagName('body')[0].appendChild(node);\n          needGenerate = true;\n        } else {\n          node.style.position = 'relative';\n        }\n\n        styleNode = document.createElement('style');\n        style = '#authing__retry a:hover{outline:0px;text-decoration:none;}#authing__spinner{position:absolute;left:50%;margin-left:-6px;}.spinner{margin:100px auto;width:20px;height:20px;position:relative}.container1>div,.container2>div,.container3>div{width:6px;height:6px;background-color:#00a1ea;border-radius:100%;position:absolute;-webkit-animation:bouncedelay 1.2s infinite ease-in-out;animation:bouncedelay 1.2s infinite ease-in-out;-webkit-animation-fill-mode:both;animation-fill-mode:both}.spinner .spinner-container{position:absolute;width:100%;height:100%}.container2{-webkit-transform:rotateZ(45deg);transform:rotateZ(45deg)}.container3{-webkit-transform:rotateZ(90deg);transform:rotateZ(90deg)}.circle1{top:0;left:0}.circle2{top:0;right:0}.circle3{right:0;bottom:0}.circle4{left:0;bottom:0}.container2 .circle1{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.container3 .circle1{-webkit-animation-delay:-1.0s;animation-delay:-1.0s}.container1 .circle2{-webkit-animation-delay:-0.9s;animation-delay:-0.9s}.container2 .circle2{-webkit-animation-delay:-0.8s;animation-delay:-0.8s}.container3 .circle2{-webkit-animation-delay:-0.7s;animation-delay:-0.7s}.container1 .circle3{-webkit-animation-delay:-0.6s;animation-delay:-0.6s}.container2 .circle3{-webkit-animation-delay:-0.5s;animation-delay:-0.5s}.container3 .circle3{-webkit-animation-delay:-0.4s;animation-delay:-0.4s}.container1 .circle4{-webkit-animation-delay:-0.3s;animation-delay:-0.3s}.container2 .circle4{-webkit-animation-delay:-0.2s;animation-delay:-0.2s}.container3 .circle4{-webkit-animation-delay:-0.1s;animation-delay:-0.1s}@-webkit-keyframes bouncedelay{0%,80%,100%{-webkit-transform:scale(0.0)}40%{-webkit-transform:scale(1.0)}}@keyframes bouncedelay{0%,80%,100%{transform:scale(0.0);-webkit-transform:scale(0.0)}40%{transform:scale(1.0);-webkit-transform:scale(1.0)}}';\n        styleNode.type = 'text/css';\n\n        if (styleNode.style) {\n          styleNode.style.cssText = style;\n        } else {\n          styleNode.innerHTML = style;\n        }\n\n        document.getElementsByTagName('head')[0].appendChild(styleNode);\n\n        loading = function () {\n          node.innerHTML = '<div id=\"authing__spinner\" class=\"spinner\"><div class=\"spinner-container container1\"><div class=\"circle1\"></div><div class=\"circle2\"></div><div class=\"circle3\"></div><div class=\"circle4\"></div></div><div class=\"spinner-container container2\"><div class=\"circle1\"></div><div class=\"circle2\"></div><div class=\"circle3\"></div><div class=\"circle4\"></div></div><div class=\"spinner-container container3\"><div class=\"circle1\"></div><div class=\"circle2\"></div><div class=\"circle3\"></div><div class=\"circle4\"></div></div></div>';\n        };\n\n        unloading = function () {\n          var child = document.getElementById('authing__spinner');\n          if (child) node.removeChild(child);\n        };\n\n        genTip = function (text) {\n          var formattedText;\n\n          try {\n            formattedText = JSON.parse(text).message || text;\n          } catch (e) {\n            formattedText = text;\n          }\n\n          var tip = document.createElement('span');\n          tip.className = 'authing__heading-subtitle';\n\n          if (!needGenerate) {\n            createCssClassStyleSheet('__authing__heading-subtitle-style', 'display: block;font-weight: 400;font-size: 15px;color: #888;line-height: 20px;margin-top: 8px;');\n            tip.classList.add('__authing__heading-subtitle-style');\n          } else {\n            createCssClassStyleSheet('__authing__heading-subtitle-style', 'display: block;font-weight: 400;font-size: 12px;color: #888;');\n            tip.classList.add('__authing__heading-subtitle-style');\n          }\n\n          tip.id = 'authing__qrcode-tip-text';\n          tip.innerHTML = formattedText;\n          return tip;\n        };\n\n        editTipText = function (text) {\n          var el = document.getElementById('authing__qrcode-tip-text');\n\n          if (el) {\n            el.innerText = text;\n          }\n        };\n\n        genImage = function (src) {\n          return new Promise(function (resolve) {\n            var qrcodeImage = document.createElement('img'); // qrcodeImage.className = 'authing__qrcode';\n\n            qrcodeImage.src = src;\n            qrcodeImage.width = size.width;\n            qrcodeImage.height = size.height;\n            qrcodeImage.setAttribute('crossOrigin', 'Anonymous'); // qrcodeImage.draggable = false;\n\n            qrcodeImage.onload = function () {\n              resolve(qrcodeImage);\n            };\n          });\n        };\n\n        genLogoInCenter = function (logo) {\n          // logo 有可能是 undefined，走 onerror 不解除 display:none 即可\n          // 因此，即便是空的 src 地址，为了保证类型一致，同样要返回 HTMLImageElement\n          return new Promise(function (resolve) {\n            var qrcodeLogo = document.createElement('img');\n            qrcodeLogo.src = logo;\n            qrcodeLogo.setAttribute('crossOrigin', 'Anonymous'); // qrcodeLogo.className = 'authing__qrcode__logo';\n            // qrcodeLogo.draggable = false;\n            // qrcodeLogo.style.display = 'none';\n            // qrcodeLogo.style.borderRadius = '50%';\n            // 这里设置宽高没啥意义，不设置可能会导致 safari 报错\n\n            qrcodeLogo.width = size.width / 2.4;\n            qrcodeLogo.height = size.height / 2.4; // // 计算得到 offset 数值\n            // let containerHalfWidth = size.width / 2;\n            // let containerHalfHeight = size.height / 2;\n            // let logoHalfWidth = qrcodeLogo.width / 2;\n            // let logoHalfHeight = qrcodeLogo.height / 2;\n            // let offset = {\n            //   x: containerHalfWidth - logoHalfWidth,\n            //   y: containerHalfHeight - logoHalfHeight\n            // };\n            // createCssClassStyleSheet(\n            //   'authing__qrcode__logo',\n            //   `\n            //     border-radius: 50%;\n            //     position: absolute;\n            //     left: ${offset.y}px;\n            //     top: ${offset.x}px;\n            //   `\n            // );\n\n            qrcodeLogo.onload = function () {\n              qrcodeLogo.style.display = 'inline';\n              resolve(qrcodeLogo);\n            };\n\n            qrcodeLogo.onerror = function () {\n              resolve(qrcodeLogo);\n            };\n          });\n        };\n\n        genShadowMiddleStatus = function (text) {\n          // prefix: 修改提示文字\n          editTipText(middleTitle); // 1. 生成 successWrapper \n\n          var successWrapper = document.createElement('div');\n          createCssClassStyleSheet('__authing-shadow-inner-style-position', \"position:absolute;top:56%;left:50%;\\n         width:64px;transform:translate(-50%,-50%);\\n        background-position:center center;\\n      align-items: center; /*\\u5782\\u76F4\\u5C45\\u4E2D*/\\n      justify-content: center; /*\\u6C34\\u5E73\\u5C45\\u4E2D*/\");\n          successWrapper.classList.add('__authing-shadow-inner-style-position'); // 2. 创建图片节点\n\n          var successImage = document.createElement('div');\n          createCssClassStyleSheet('__authing-shadow-inner-image-style-position', \"width:64px;height:64px;opacity:1;\\n        background-position:center center;background-repeat:no-repeat;\\n        background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTQiIGhlaWdodD0iNTQiIHZpZXdCb3g9IjAgMCA1NCA1NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTI3IDUzLjY2NjdDMTIuMjcyIDUzLjY2NjcgMC4zMzMzNzQgNDEuNzI4IDAuMzMzMzc0IDI3QzAuMzMzMzc0IDEyLjI3MiAxMi4yNzIgMC4zMzMzMzIgMjcgMC4zMzMzMzJDNDEuNzI4IDAuMzMzMzMyIDUzLjY2NjcgMTIuMjcyIDUzLjY2NjcgMjdDNTMuNjY2NyA0MS43MjggNDEuNzI4IDUzLjY2NjcgMjcgNTMuNjY2N1pNMjQuMzQxNCAzNy42NjY3TDQzLjE5NDcgMTguODEwN0wzOS40MjQgMTUuMDRMMjQuMzQxNCAzMC4xMjUzTDE2Ljc5NzQgMjIuNTgxM0wxMy4wMjY3IDI2LjM1MkwyNC4zNDE0IDM3LjY2NjdaIiBmaWxsPSIjMUVCNzZEIi8+Cjwvc3ZnPgo=);\\n        margin-bottom: 10px;\\n      align-items: center; /*\\u5782\\u76F4\\u5C45\\u4E2D*/\\n      justify-content: center; /*\\u6C34\\u5E73\\u5C45\\u4E2D*/\");\n          successImage.classList.add('__authing-shadow-inner-image-style-position');\n          successImage.id = 'authing_scan_success_image'; // 3. 创建文字节点\n\n          var successTextNode = document.createElement('p');\n          createCssClassStyleSheet('__authing-shadow-inner-text-style-position', \"font-weight: 400;font-size: 14px;line-height: 20px;color: #282D3C;;align-items: center; /*\\u5782\\u76F4\\u5C45\\u4E2D*/justify-content: center; /*\\u6C34\\u5E73\\u5C45\\u4E2D*/\");\n          successTextNode.classList.add('__authing-shadow-inner-text-style-position');\n          successTextNode.id = 'authing_scan_success_text';\n          successTextNode.innerText = text;\n          successWrapper.appendChild(successImage);\n          successWrapper.appendChild(successTextNode);\n          return successWrapper;\n        };\n\n        genReferTextNode = function (text) {\n          var referTextNode = document.createElement('p');\n          createCssClassStyleSheet('__authing-shadow-inner-refer-text-style-position', \"color: #215AE5;font-size: 14px;line-height:20px;font-weight: 400; text-align:center;cursor:pointer;padding-top:4px;\");\n          referTextNode.classList.add('__authing-shadow-inner-refer-text-style-position');\n          referTextNode.id = 'authing_scan_success_refer_text';\n          referTextNode.innerText = text; // 点击事件 TODO: 内置了方法封装 回头在处理下\n\n          referTextNode.onclick = function () {\n            if (_this.timer) {\n              clearInterval(_this.timer);\n            }\n\n            if (onRetry) {\n              onRetry();\n            }\n\n            start();\n          };\n\n          return referTextNode;\n        };\n\n        removeReferTextNode = function () {\n          var id = 'authing_scan_success_refer_text';\n          var dom = document.getElementById(id);\n\n          if (dom) {\n            dom.parentNode.removeChild(dom);\n          }\n        };\n\n        genShadow = function (text, aOnClick, shadowAId) {\n          var shadowId = 'authing__retry';\n\n          if (document.getElementById(shadowId)) {\n            document.getElementById(shadowId).remove();\n          }\n\n          var shadow = document.createElement('div');\n          shadow.id = shadowId;\n          createCssClassStyleSheet('__authing-shadow-style', \"text-align:center;width: \" + size.width + \"px;height: \" + size.height + \"px;position: absolute;left: 50%;top: 0px;margin-left: -\" + size.width / 2 + \"px;background-color: rgba(0,0,0, 0.5);line-height:\" + size.height + \"px;color:#fff;font-weight:600;\");\n          shadow.classList.add('__authing-shadow-style');\n          var shadowA = document.createElement('a');\n          shadowA.innerHTML = text;\n          shadowA.style.color = '#fff';\n          shadowA.style.borderBottom = '1px solid #fff';\n          shadowA.style.cursor = 'pointer';\n\n          if (aOnClick) {\n            shadowA.addEventListener('click', aOnClick);\n          }\n\n          shadowA.id = shadowAId;\n          shadow.appendChild(shadowA);\n          return shadow;\n        };\n\n        displayScannedUser = function (_) {\n          var shadowId = 'authing__retry';\n\n          if (document.getElementById(shadowId)) {\n            document.getElementById(shadowId).remove();\n          }\n\n          var shadow = document.createElement('div'); // TODO: 获得 img 标签的大小，然后给赋给这招大小\n\n          createCssClassStyleSheet('__authing-shadow-style-position', \"text-align:center;width:\" + size.width + \"px;height: \" + size.height + \"px;background:rgba(255,255,255,.97);position: absolute;left: 50%;top: 0px;margin-left: -\" + size.width / 2 + \"px;line-height:\" + size.height + \"px;color:#fff;font-weight:600;display: flex;\\n      align-items: center; /*\\u5782\\u76F4\\u5C45\\u4E2D*/\\n      justify-content: center; /*\\u6C34\\u5E73\\u5C45\\u4E2D*/\");\n          shadow.classList.add('__authing-shadow-style-position');\n          shadow.id = shadowId; // 生成文字节点 如果是微信扫码不需要中间状\n\n          var successWrapper = genShadowMiddleStatus(succeed); // 生成按钮节点\n\n          var referTextNode = genReferTextNode(referText);\n          nodeWrapper.appendChild(referTextNode);\n          shadow.appendChild(successWrapper);\n          return shadow;\n        };\n\n        start = function () {\n          return __awaiter(_this, void 0, void 0, function () {\n            var random, url, logo, data, error_1, qrcodeImage, qrcodeLogo, canvas, context2D, _a, x, y, ww, hh, base64, img, decoratedOnSuccess, decoratedOnScanned, decoratedOnCancel, decoratedOnExpired, decoratedOnError, tip, dom;\n\n            var _this = this;\n\n            return __generator(this, function (_b) {\n              switch (_b.label) {\n                case 0:\n                  loading();\n                  random = null;\n                  url = null;\n                  logo = null;\n                  _b.label = 1;\n\n                case 1:\n                  _b.trys.push([1, 3,, 4]);\n\n                  return [4\n                  /*yield*/\n                  , this.geneCode({\n                    context: context,\n                    customData: customData,\n                    extIdpConnId: extIdpConnId,\n                    withCustomData: withCustomData\n                  })];\n\n                case 2:\n                  data = _b.sent();\n                  random = data.random;\n                  url = data.url;\n                  logo = data.customLogo;\n                  return [3\n                  /*break*/\n                  , 4];\n\n                case 3:\n                  error_1 = _b.sent();\n                  error_1 = error_1;\n                  genRetry(node, error_1.message);\n\n                  if (onCodeLoadFailed) {\n                    onCodeLoadFailed(error_1);\n                  }\n\n                  return [2\n                  /*return*/\n                  ];\n\n                case 4:\n                  if (onCodeLoaded) {\n                    onCodeLoaded(random, url);\n                  }\n\n                  nodeWrapper = document.createElement('div');\n                  nodeWrapper.id = 'authing__qrcode-wrapper';\n                  nodeWrapper.style.textAlign = 'center';\n                  nodeWrapper.style.position = 'relative';\n                  nodeWrapper.style.margin = 'auto';\n                  return [4\n                  /*yield*/\n                  , genImage(url)];\n\n                case 5:\n                  qrcodeImage = _b.sent();\n                  if (!logo) return [3\n                  /*break*/\n                  , 7];\n                  return [4\n                  /*yield*/\n                  , genLogoInCenter(logo)];\n\n                case 6:\n                  qrcodeLogo = _b.sent();\n                  _b.label = 7;\n\n                case 7:\n                  canvas = document.createElement('canvas');\n                  canvas.width = size.width;\n                  canvas.height = size.height;\n                  context2D = canvas.getContext('2d');\n                  url && context2D.drawImage(qrcodeImage, 0, 0, size.width, size.height);\n                  _a = getOffset(size), x = _a.x, y = _a.y, ww = _a.ww, hh = _a.hh;\n                  context2D.save();\n                  roundedImage(context2D, x, y, ww, hh, ww / 2);\n                  context2D.clip();\n\n                  try {\n                    qrcodeLogo && context2D.drawImage(qrcodeLogo, x, y, ww, hh);\n                  } catch (_c) {\n                    console.log('Draw stop, check qrcodeLogo', qrcodeLogo);\n                  }\n\n                  context2D.restore();\n\n                  try {\n                    base64 = canvas.toDataURL();\n                    img = document.createElement('img');\n                    img.src = base64;\n                    nodeWrapper.appendChild(img);\n                  } catch (_d) {\n                    // base64 不可行，可能被浏览器拦截（同源策略）\n                    // 直接绘制 canvas 并渲染，确保基本功能可用\n                    nodeWrapper.appendChild(canvas);\n                  }\n\n                  unloading();\n\n                  if (onCodeShow) {\n                    onCodeShow(random, url);\n                  }\n\n                  decoratedOnSuccess = function (userInfo, ticket) {\n                    // prefix: 修改提示文字\n                    editTipText(''); // 移除重新扫码DOM\n\n                    removeReferTextNode();\n                    var shadow = genShadow(succeed, null, '__authing_success_tip');\n                    nodeWrapper.appendChild(shadow);\n\n                    if (onSuccess) {\n                      if (autoExchangeUserInfo) {\n                        var token = userInfo.token;\n\n                        if (!token) {\n                          // 轮询接口不会返回完整用户信息，需要使用 ticket 换取\n                          _this.exchangeUserInfo(ticket).then(function (userInfo) {\n                            // @ts-ignore\n                            _this.tokenProvider.setUser(userInfo); // @ts-ignore\n\n\n                            onSuccess(userInfo, ticket);\n                          });\n                        } else {\n                          onSuccess(userInfo, ticket);\n                        }\n                      } else {\n                        onSuccess(userInfo, ticket);\n                      }\n                    }\n                  };\n\n                  decoratedOnScanned = function (userInfo) {\n                    var shadow = displayScannedUser(userInfo.nickname);\n                    nodeWrapper.appendChild(shadow);\n\n                    if (onScanned) {\n                      onScanned(userInfo);\n                    }\n                  };\n\n                  decoratedOnCancel = function () {\n                    // 取消授权直接刷新二维码\n                    if (start) {\n                      start();\n                    } // const shadow = genShadow(canceled, null, '__authing_success_tip');\n                    // nodeWrapper.appendChild(shadow);\n\n\n                    if (onCancel) {\n                      onCancel();\n                    }\n                  };\n\n                  decoratedOnExpired = function () {\n                    var shadow = genShadow(expired, function () {\n                      nodeWrapper.innerHTML = '';\n                      start();\n                    }, '__authing_success_tip');\n                    nodeWrapper.appendChild(shadow);\n\n                    if (onExpired) {\n                      onExpired();\n                    }\n                  };\n\n                  decoratedOnError = function (data) {\n                    var message = data.message;\n\n                    if (onError) {\n                      onError(message);\n                    }\n                  }; // 开始轮询\n\n\n                  this.startPolling(random, {\n                    interval: interval,\n                    onStart: onStart,\n                    onResult: onResult,\n                    onScanned: decoratedOnScanned,\n                    onExpired: decoratedOnExpired,\n                    onSuccess: decoratedOnSuccess,\n                    onCancel: decoratedOnCancel,\n                    onError: decoratedOnError,\n                    onMfa: onMfa,\n                    onAuthFlow: onAuthFlow\n                  });\n                  tip = genTip(title);\n                  nodeWrapper.appendChild(tip);\n                  dom = document.querySelector('#authing__qrcode-wrapper');\n                  if (dom) dom.remove();\n                  node.appendChild(nodeWrapper);\n                  return [2\n                  /*return*/\n                  ];\n              }\n            });\n          });\n        };\n\n        start();\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n  /**\n   * @name geneCode\n   * @name_zh 生成二维码\n   * @description 生成二维码\n   *\n   * @example\n   * const authenticationClient = new AuthenticationClient({\n   *    appId: \"YOUR_APP_ID\",\n   * })\n   * const { url, random } = await authenticationClient.wxqrcode.geneCode()\n   *\n   * # random 二维码唯一 ID\n   * # url 二维码链接\n   *\n   * @returns {Promise<QRCodeGenarateResult>}\n   * @memberof QrCodeAuthenticationClient\n   */\n\n\n  QrCodeAuthenticationClient.prototype.geneCode = function (options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, context, customData, extIdpConnId, withCustomData, api, data;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = options || {}, context = _a.context, customData = _a.customData, extIdpConnId = _a.extIdpConnId, withCustomData = _a.withCustomData;\n            api = this.baseClient.appHost + \"/api/v2/qrcode/gene\";\n            return [4\n            /*yield*/\n            , this.httpClient.request({\n              method: 'POST',\n              url: api,\n              data: {\n                autoMergeQrCode: false,\n                scene: this.scene,\n                context: context,\n                params: customData,\n                extIdpConnId: extIdpConnId,\n                withCustomData: withCustomData\n              }\n            })];\n\n          case 1:\n            data = _b.sent();\n            return [2\n            /*return*/\n            , data];\n        }\n      });\n    });\n  };\n  /**\n   * @name checkStatus\n   * @name_zh 检测扫码状态\n   * @description 检测扫码状态\n   *\n   * @param {string} random\n   *\n   * @example\n   *\n   * const authenticationClient = new AuthenticationClient({\n   *    appId: \"YOUR_APP_ID\",\n   * })\n   * const { random, status, ticket, userInfo } = await authenticationClient.wxqrcode.checkStatus('RANDOM')\n   * # status: 二维码状态: 0 - 未使用, 1 - 已扫码, 2 - 已授权, 3 - 取消授权, -1 - 已过期\n   * # ticket: 用于换取用户信息的一个随机字符串\n   * # userInfo: 用户信息\n   *\n   * @returns {Promise<QRCodeStatus>}\n   * @memberof QrCodeAuthenticationClient\n   */\n\n\n  QrCodeAuthenticationClient.prototype.checkStatus = function (random) {\n    return __awaiter(this, void 0, void 0, function () {\n      var api, data;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            api = this.baseClient.appHost + \"/api/v2/qrcode/check?random=\" + random;\n            return [4\n            /*yield*/\n            , this.httpClient.request({\n              method: 'GET',\n              url: api\n            })];\n\n          case 1:\n            data = _a.sent();\n            return [2\n            /*return*/\n            , data];\n        }\n      });\n    });\n  };\n  /**\n   * @name exchangeUserInfo\n   * @name_zh 使用 ticket 交换用户信息\n   * @description 使用 ticket 交换用户信息\n   *\n   * @example\n   *\n   * const authenticationClient = new AuthenticationClient({\n   *    appId: \"YOUR_APP_ID\",\n   * })\n   * const user = await authenticationClient.wxqrcode.exchangeUserInfo('TICKET')\n   * # user: 完整的用户信息，其中 user.token 为用户的登录凭证。\n   *\n   * @param {string} ticket ticket\n   * @returns {Promise<Partial<User>>}\n   * @memberof QrCodeAuthenticationClient\n   */\n\n\n  QrCodeAuthenticationClient.prototype.exchangeUserInfo = function (ticket) {\n    return __awaiter(this, void 0, void 0, function () {\n      var api, userInfo;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            api = this.baseClient.appHost + \"/api/v2/qrcode/userinfo\";\n            return [4\n            /*yield*/\n            , this.httpClient.request({\n              method: 'POST',\n              url: api,\n              data: {\n                ticket: ticket\n              }\n            })];\n\n          case 1:\n            userInfo = _a.sent();\n            return [2\n            /*return*/\n            , userInfo];\n        }\n      });\n    });\n  };\n  /**\n   * @name startPolling\n   * @name_zh 开始轮询二维码状态\n   * @description 开始轮询二维码状态\n   *\n   * @param {string} random 二维码唯一 ID\n   * @param {Object} options\n   * @param {number} options.interval 间隔时间，单位为毫秒，默认为 800 毫秒\n   * @param {Function} options.onStart 开始轮询的事件回调函数, 第一个参数为 setInterval 返回的计时器，可以用 clearInterval 取消此计时器\n   * @param {Function} options.onResult 获取到二维码最新状态事件回调函数，第一个参数为的类型为 QRCodeStatus。\n   * @param {Function} options.onScanned 用户首次扫码事件回调函数。此时用户还没有授权，回调的用户信息中通仅包含昵称和头像，用作展示目的。\n   * 出于安全性考虑，默认情况下，userInfo 只会包含昵称（nickname）和头像（photo）两个字段，开发者也可以在后台配置使其返回完整用户信息，\n   * @param {Function} options.onSuccess 用户同意授权事件回调函数。该函数只会回调一次，之后轮询结束。第一个参数为 userInfo 用户信息，第二个参数为 ticket，用于换取用户的详情。\n   * 详情见 https://docs.authing.co/scan-qrcode/app-qrcode/customize.html。\n   * ticket 可以用来换取完整的用户信息，相关接口见 https://docs.authing.co/scan-qrcode/app-qrcode/full-api-list.html。\n   * @param {Function} options.onCancel 用户取消授权事件回调函数。该事件只会回调一次，之后轮询结束。\n   * @param {Function} options.onError 获取二维码状态失败事件回调函数。常见原因为网络失败等，每次查询失败时都会回调。回调参数 data 示例如 {\"code\": 2241,\"message\": \"二维码不存在\" }\n   * @param {Function} options.onExpired 二维码失效时被回调，只回调一次，之后轮询结束。\n   *\n   * @returns {null}\n   * @memberof QrCodeAuthenticationClient\n   */\n\n\n  QrCodeAuthenticationClient.prototype.startPolling = function (random, options) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, interval, onStart, onResult, onScanned, onExpired, onSuccess, onCancel, onError, onMfa, onAuthFlow, calledOnScanned, callOnPoolingStart, timer;\n\n      var _this = this;\n\n      return __generator(this, function (_b) {\n        options = options || {};\n        _a = options.interval, interval = _a === void 0 ? 800 : _a, onStart = options.onStart, onResult = options.onResult, onScanned = options.onScanned, onExpired = options.onExpired, onSuccess = options.onSuccess, onCancel = options.onCancel, onError = options.onError, onMfa = options.onMfa, onAuthFlow = options.onAuthFlow;\n        calledOnScanned = false;\n        callOnPoolingStart = false;\n        timer = this.timer = setInterval(function () {\n          return __awaiter(_this, void 0, void 0, function () {\n            var data, status_1, ticket, userInfo, scannedResult, code, message, mfaData, scannedResult, scannedResult, errmsg, error_2;\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  // 开始轮询时回调 onPollingStart\n                  if (onStart && !callOnPoolingStart) {\n                    onStart(timer);\n                    callOnPoolingStart = true;\n                  }\n\n                  _a.label = 1;\n\n                case 1:\n                  _a.trys.push([1, 3,, 4]);\n\n                  return [4\n                  /*yield*/\n                  , this.checkStatus(random)];\n\n                case 2:\n                  data = _a.sent();\n                  status_1 = data.status, ticket = data.ticket, userInfo = data.userInfo; // 每次获取到数据都回调 onResult 函数\n\n                  if (onResult) {\n                    onResult(data);\n                  } // 过期\n\n\n                  if (status_1 === -1) {\n                    clearInterval(timer);\n\n                    if (onExpired) {\n                      onExpired();\n                    }\n                  } // 未扫码\n\n\n                  if (status_1 === 0) {} // 已扫码\n\n\n                  if (status_1 === 1) {\n                    if (onScanned && !calledOnScanned) {\n                      onScanned(userInfo);\n                      calledOnScanned = true;\n                    }\n                  } // 已授权\n\n\n                  if (status_1 === 2) {\n                    clearInterval(timer);\n\n                    if (onSuccess) {\n                      onSuccess(userInfo, ticket);\n                    }\n                  } // 已取消\n\n\n                  if (status_1 === 3) {\n                    clearInterval(timer);\n\n                    if (onCancel) {\n                      onCancel();\n                    }\n                  } // 需要 MFA\n\n\n                  if (status_1 === 4) {\n                    clearInterval(timer);\n\n                    if (onMfa) {\n                      scannedResult = data.scannedResult;\n                      code = scannedResult.code, message = scannedResult.message, mfaData = scannedResult.data;\n                      onMfa(code, message, mfaData);\n                    }\n\n                    if (onAuthFlow) {\n                      scannedResult = data.scannedResult;\n                      onAuthFlow(scannedResult);\n                    }\n                  } // 未知错误\n\n\n                  if (status_1 === 5) {\n                    clearInterval(timer);\n\n                    if (onError) {\n                      scannedResult = data.scannedResult;\n                      errmsg = scannedResult.errmsg;\n                      onError(errmsg);\n                    }\n                  }\n\n                  return [3\n                  /*break*/\n                  , 4];\n\n                case 3:\n                  error_2 = _a.sent();\n\n                  if (onError) {\n                    onError(error_2);\n                  }\n\n                  clearInterval(timer);\n                  return [2\n                  /*return*/\n                  ];\n\n                case 4:\n                  return [2\n                  /*return*/\n                  ];\n              }\n            });\n          });\n        }, interval);\n        return [2\n        /*return*/\n        , timer];\n      });\n    });\n  };\n\n  QrCodeAuthenticationClient.prototype.stopPolling = function (timer) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        clearInterval(timer);\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n\n  return QrCodeAuthenticationClient;\n}();\n\nexport { QrCodeAuthenticationClient };","map":{"version":3,"sources":["../../../../src/lib/authentication/QrCodeAuthenticationClient.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport { createCssClassStyleSheet } from '../utils';\nimport { BaseAuthenticationClient } from './BaseAuthenticationClient';\n/**\n * @class QrCodeAuthenticationClient 扫码登录模块\n * @description 此模块用于进行扫码登录，扫码登录分为两种小程序扫码登录（wxqrcode）和 APP 扫码登录（qrcode）。两种扫码登录方式 API 完全一致。\n *\n * 使用小程序扫码登录：\n *\n * \\`\\`\\`javascript\n * import { AuthenticationClient } from \"authing-js-sdk\"\n * const authenticationClient = new AuthenticationClient({\n *    appId: \"YOUR_APP_ID\",\n * })\n * authenticationClient.wxqrcode.startScanning() # 开始扫码登录\n * \\`\\`\\`\n *\n * 使用 APP 扫码登录\n *\n * \\`\\`\\`javascript\n * import { AuthenticationClient } from \"authing-js-sdk\"\n * const authenticationClient = new AuthenticationClient({\n *    appId: \"YOUR_APP_ID\",\n * })\n * authenticationClient.qrcode.startScanning() # 开始扫码登录\n * \\`\\`\\`\n *\n * @name QrCodeAuthenticationClient\n */\nvar roundedImage = function (context2D, x, y, width, height, radius) {\n    context2D.beginPath();\n    context2D.moveTo(x + radius, y);\n    context2D.lineTo(x + width - radius, y);\n    context2D.quadraticCurveTo(x + width, y, x + width, y + radius);\n    context2D.lineTo(x + width, y + height - radius);\n    context2D.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    context2D.lineTo(x + radius, y + height);\n    context2D.quadraticCurveTo(x, y + height, x, y + height - radius);\n    context2D.lineTo(x, y + radius);\n    context2D.quadraticCurveTo(x, y, x + radius, y);\n    context2D.closePath();\n};\nvar getOffset = function (size) {\n    var containerHalfWidth = size.width / 2;\n    var containerHalfHeight = size.height / 2;\n    var ww = size.width / 2.4;\n    var hh = size.height / 2.4;\n    var logoHalfWidth = ww / 2;\n    var logoHalfHeight = hh / 2;\n    return {\n        x: containerHalfWidth - logoHalfWidth,\n        y: containerHalfHeight - logoHalfHeight,\n        ww: ww,\n        hh: hh\n    };\n};\nvar QrCodeAuthenticationClient = /** @class */ (function () {\n    function QrCodeAuthenticationClient(options, tokenProvider, httpClient, scene) {\n        this.options = options;\n        this.tokenProvider = tokenProvider;\n        this.httpClient = httpClient;\n        this.scene = scene;\n        this.baseClient = new BaseAuthenticationClient(options);\n    }\n    /**\n     * @name startScanning\n     * @name_zh 一键开始扫码\n     * @description 一键开始扫码\n     *\n     * @param {string} domId DOM 元素的 ID。\n     * @param {Object} options\n     * @param {boolean} options.autoExchangeUserInfo 是否自定义使用 ticket 换取用户信息\n     * @param {number} options.interval 间隔时间，单位为毫秒，默认为 800 毫秒\n     * @param {Function} options.onStart 开始轮询的事件回调函数, 第一个参数为 setInterval 返回的计时器，可以用 clearInterval 取消此计时器\n     * @param {Function} options.onResult 获取到二维码最新状态事件回调函数，第一个参数为的类型为 QRCodeStatus。\n     * @param {Function} options.onScanned 用户首次扫码事件回调函数。此时用户还没有授权，回调的用户信息中通仅包含昵称和头像，用作展示目的。\n     * 出于安全性考虑，默认情况下，userInfo 只会包含昵称（nickname）和头像（photo）两个字段，开发者也可以在后台配置使其返回完整用户信息，\n     * @param {Function} options.onSuccess 用户同意授权事件回调函数。该函数只会回调一次，之后轮询结束。第一个参数为 userInfo 用户信息，第二个参数为 ticket，用于换取用户的详情。\n     * 详情见 https://docs.authing.co/scan-qrcode/app-qrcode/customize.html。\n     * ticket 可以用来换取完整的用户信息，相关接口见 https://docs.authing.co/scan-qrcode/app-qrcode/full-api-list.html。\n     * @param {Function} options.onCancel 用户取消授权事件回调函数。该事件只会回调一次，之后轮询结束。\n     * @param {Function} options.onError 获取二维码状态失败事件回调函数。常见原因为网络失败等，每次查询失败时都会回调。回调参数 data 示例如 {\"code\": 2241,\"message\": \"二维码不存在\" }\n     * @param {Function} options.onExpired 二维码失效时被回调，只回调一次，之后轮询结束。\n     * @param {Function} options.onCodeShow 二维码首次成功显示的事件。\n     * @param {Function} options.onCodeLoaded 二维码首次成功 Load 的事件。\n     * @param {Function} options.onCodeLoadFailed 二维码加载失败的事件。\n     * @param {Function} options.onCodeDestroyed 二维码被销毁的事件。\n     * @param {string} options.extIdpConnId 多租户用的额外的 Idp Id。\n     * @param {Function} options.onRetry 二维码重试事件。\n     * @param {Object} options.size 二维码图片大小，默认为 240 * 240，单位为 px 。\n     * @param {number} options.size.height 高度\n     * @param {number} options.size.width 宽度\n     * @param {Object} options.containerSize DOM 容器大小，默认为 300 * 300，单位为 px 。\n     * @param {number} options.containerSize.height 高度\n     * @param {number} options.containerSize.width 宽度\n     * @param {Object} options.tips 自定义提示信息\n     * @param {number} options.tips.title\n     * @param {number} options.tips.scanned\n     * @param {Object} options.tips.succeed\n     * @param {number} options.tips.canceled\n     * @param {number} options.tips.expired\n     * @param {number} options.tips.retry\n     * @param {number} options.tips.failed\n     *\n     * @example\n     *\n     * authenticationClient.wxqrcode.startScanning(\"qrcode\", {\n     *  onSuccess: (userInfo, ticket) => {\n     *    console.log(userInfo, ticket)\n     *  },\n     *  onError: (message) => onFail && onFail(`${message}`),\n     * });\n     *\n     * @returns {null}\n     * @memberof QrCodeAuthenticationClient\n     *\n     */\n    QrCodeAuthenticationClient.prototype.startScanning = function (domId, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            function genRetry(qrcodeElm, tipText, retryId) {\n                return __awaiter(this, void 0, void 0, function () {\n                    var tip, qrcodeImage, shadow, dom;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                tip = genTip(tipText);\n                                nodeWrapper = document.createElement('div');\n                                nodeWrapper.id = 'authing__qrcode-wrapper';\n                                nodeWrapper.style.textAlign = 'center';\n                                nodeWrapper.style.position = 'relative';\n                                return [4 /*yield*/, genImage('https://usercontents.authing.cn/0ab3a1bf19c0d7106673e494d532f91a.png')];\n                            case 1:\n                                qrcodeImage = _a.sent();\n                                if (!needGenerate) {\n                                    qrcodeImage.style.marginTop = '12px';\n                                }\n                                else {\n                                    qrcodeImage.style.marginTop = '16px';\n                                }\n                                qrcodeImage.onload = function () {\n                                    unloading();\n                                };\n                                shadow = genShadow(retry, function () {\n                                    if (onRetry) {\n                                        onRetry();\n                                    }\n                                    start();\n                                }, retryId || '__authing_retry_btn');\n                                nodeWrapper.appendChild(qrcodeImage);\n                                nodeWrapper.appendChild(shadow);\n                                nodeWrapper.appendChild(tip);\n                                dom = document.querySelector('#authing__qrcode-wrapper');\n                                if (dom)\n                                    dom.remove();\n                                qrcodeElm.appendChild(nodeWrapper);\n                                return [2 /*return*/];\n                        }\n                    });\n                });\n            }\n            var _a, autoExchangeUserInfo, _b, size, _c, containerSize, _d, interval, onStart, onResult, onScanned, onExpired, onSuccess, onCancel, onError, onCodeShow, onCodeLoaded, onCodeLoadFailed, onRetry, onMfa, onAuthFlow, _e, \n            // onCodeDestroyed,\n            tips, context, customData, extIdpConnId, withCustomData, lang, nowLang, _f, title, _g, \n            // @ts-ignore\n            canceled, _h, expired, _j, succeed, _k, retry, _l, middleTitle, _m, referText, node, nodeWrapper, needGenerate, styleNode, style, loading, unloading, genTip, editTipText, genImage, genLogoInCenter, genShadowMiddleStatus, genReferTextNode, removeReferTextNode, genShadow, displayScannedUser, start;\n            var _this = this;\n            return __generator(this, function (_o) {\n                options = options || {};\n                _a = options.autoExchangeUserInfo, autoExchangeUserInfo = _a === void 0 ? false : _a, _b = options.size, size = _b === void 0 ? {\n                    height: 240,\n                    width: 240\n                } : _b, _c = options.containerSize, containerSize = _c === void 0 ? {\n                    height: 300,\n                    width: 300\n                } : _c, _d = options.interval, interval = _d === void 0 ? 800 : _d, onStart = options.onStart, onResult = options.onResult, onScanned = options.onScanned, onExpired = options.onExpired, onSuccess = options.onSuccess, onCancel = options.onCancel, onError = options.onError, onCodeShow = options.onCodeShow, onCodeLoaded = options.onCodeLoaded, onCodeLoadFailed = options.onCodeLoadFailed, onRetry = options.onRetry, onMfa = options.onMfa, onAuthFlow = options.onAuthFlow, _e = options.tips, tips = _e === void 0 ? {} : _e, context = options.context, customData = options.customData, extIdpConnId = options.extIdpConnId, withCustomData = options.withCustomData;\n                lang = this.options.lang;\n                nowLang = lang === 'zh-CN';\n                _f = tips.title, title = _f === void 0 ? nowLang ?\n                    \"\\u8BF7\\u5728\\u79FB\\u52A8\\u7AEF\\u786E\\u8BA4\\u8D26\\u53F7\\u767B\\u5F55\"\n                    : \"Please be on the mobile\" : _f, _g = tips.canceled, canceled = _g === void 0 ? nowLang ? '用户取消授权' : 'User cancel authorization' : _g, _h = tips.expired, expired = _h === void 0 ? nowLang ? '二维码已过期' : 'QR code has expired' : _h, _j = tips.succeed, succeed = _j === void 0 ? nowLang ? '扫码成功' : 'Scan code successfully' : _j, _k = tips.retry, retry = _k === void 0 ? nowLang ? '重试' : 'Retry' : _k, _l = tips.middleTitle, middleTitle = _l === void 0 ? nowLang ? '确认登录' : 'Confirm login' : _l, _m = tips.referText, referText = _m === void 0 ? nowLang ? '重新扫码' : 'Scan the code' : _m;\n                node = document.getElementById(domId);\n                needGenerate = false;\n                if (!node) {\n                    node = document.createElement('div');\n                    node.id = domId;\n                    createCssClassStyleSheet('__authing-qrcode-node-mount', \"z-index: 65535;position: fixed;background: #fff;width: \" + containerSize.width + \"px;height: \" + containerSize.height + \"px;left: 50%;margin-left: -\" + containerSize.width /\n                        2 + \"px;display: flex;justify-content: center;align-items: center;top: 50%;margin-top: -\" + containerSize.height /\n                        2 + \"px;border: 1px solid #ccc;\");\n                    node.classList.add('__authing-qrcode-node-mount');\n                    document.getElementsByTagName('body')[0].appendChild(node);\n                    needGenerate = true;\n                }\n                else {\n                    node.style.position = 'relative';\n                }\n                styleNode = document.createElement('style');\n                style = '#authing__retry a:hover{outline:0px;text-decoration:none;}#authing__spinner{position:absolute;left:50%;margin-left:-6px;}.spinner{margin:100px auto;width:20px;height:20px;position:relative}.container1>div,.container2>div,.container3>div{width:6px;height:6px;background-color:#00a1ea;border-radius:100%;position:absolute;-webkit-animation:bouncedelay 1.2s infinite ease-in-out;animation:bouncedelay 1.2s infinite ease-in-out;-webkit-animation-fill-mode:both;animation-fill-mode:both}.spinner .spinner-container{position:absolute;width:100%;height:100%}.container2{-webkit-transform:rotateZ(45deg);transform:rotateZ(45deg)}.container3{-webkit-transform:rotateZ(90deg);transform:rotateZ(90deg)}.circle1{top:0;left:0}.circle2{top:0;right:0}.circle3{right:0;bottom:0}.circle4{left:0;bottom:0}.container2 .circle1{-webkit-animation-delay:-1.1s;animation-delay:-1.1s}.container3 .circle1{-webkit-animation-delay:-1.0s;animation-delay:-1.0s}.container1 .circle2{-webkit-animation-delay:-0.9s;animation-delay:-0.9s}.container2 .circle2{-webkit-animation-delay:-0.8s;animation-delay:-0.8s}.container3 .circle2{-webkit-animation-delay:-0.7s;animation-delay:-0.7s}.container1 .circle3{-webkit-animation-delay:-0.6s;animation-delay:-0.6s}.container2 .circle3{-webkit-animation-delay:-0.5s;animation-delay:-0.5s}.container3 .circle3{-webkit-animation-delay:-0.4s;animation-delay:-0.4s}.container1 .circle4{-webkit-animation-delay:-0.3s;animation-delay:-0.3s}.container2 .circle4{-webkit-animation-delay:-0.2s;animation-delay:-0.2s}.container3 .circle4{-webkit-animation-delay:-0.1s;animation-delay:-0.1s}@-webkit-keyframes bouncedelay{0%,80%,100%{-webkit-transform:scale(0.0)}40%{-webkit-transform:scale(1.0)}}@keyframes bouncedelay{0%,80%,100%{transform:scale(0.0);-webkit-transform:scale(0.0)}40%{transform:scale(1.0);-webkit-transform:scale(1.0)}}';\n                styleNode.type = 'text/css';\n                if (styleNode.style) {\n                    styleNode.style.cssText = style;\n                }\n                else {\n                    styleNode.innerHTML = style;\n                }\n                document.getElementsByTagName('head')[0].appendChild(styleNode);\n                loading = function () {\n                    node.innerHTML =\n                        '<div id=\"authing__spinner\" class=\"spinner\"><div class=\"spinner-container container1\"><div class=\"circle1\"></div><div class=\"circle2\"></div><div class=\"circle3\"></div><div class=\"circle4\"></div></div><div class=\"spinner-container container2\"><div class=\"circle1\"></div><div class=\"circle2\"></div><div class=\"circle3\"></div><div class=\"circle4\"></div></div><div class=\"spinner-container container3\"><div class=\"circle1\"></div><div class=\"circle2\"></div><div class=\"circle3\"></div><div class=\"circle4\"></div></div></div>';\n                };\n                unloading = function () {\n                    var child = document.getElementById('authing__spinner');\n                    if (child)\n                        node.removeChild(child);\n                };\n                genTip = function (text) {\n                    var formattedText;\n                    try {\n                        formattedText = JSON.parse(text).message || text;\n                    }\n                    catch (e) {\n                        formattedText = text;\n                    }\n                    var tip = document.createElement('span');\n                    tip.className = 'authing__heading-subtitle';\n                    if (!needGenerate) {\n                        createCssClassStyleSheet('__authing__heading-subtitle-style', 'display: block;font-weight: 400;font-size: 15px;color: #888;line-height: 20px;margin-top: 8px;');\n                        tip.classList.add('__authing__heading-subtitle-style');\n                    }\n                    else {\n                        createCssClassStyleSheet('__authing__heading-subtitle-style', 'display: block;font-weight: 400;font-size: 12px;color: #888;');\n                        tip.classList.add('__authing__heading-subtitle-style');\n                    }\n                    tip.id = 'authing__qrcode-tip-text';\n                    tip.innerHTML = formattedText;\n                    return tip;\n                };\n                editTipText = function (text) {\n                    var el = document.getElementById('authing__qrcode-tip-text');\n                    if (el) {\n                        el.innerText = text;\n                    }\n                };\n                genImage = function (src) {\n                    return new Promise(function (resolve) {\n                        var qrcodeImage = document.createElement('img');\n                        // qrcodeImage.className = 'authing__qrcode';\n                        qrcodeImage.src = src;\n                        qrcodeImage.width = size.width;\n                        qrcodeImage.height = size.height;\n                        qrcodeImage.setAttribute('crossOrigin', 'Anonymous');\n                        // qrcodeImage.draggable = false;\n                        qrcodeImage.onload = function () {\n                            resolve(qrcodeImage);\n                        };\n                    });\n                };\n                genLogoInCenter = function (logo) {\n                    // logo 有可能是 undefined，走 onerror 不解除 display:none 即可\n                    // 因此，即便是空的 src 地址，为了保证类型一致，同样要返回 HTMLImageElement\n                    return new Promise(function (resolve) {\n                        var qrcodeLogo = document.createElement('img');\n                        qrcodeLogo.src = logo;\n                        qrcodeLogo.setAttribute('crossOrigin', 'Anonymous');\n                        // qrcodeLogo.className = 'authing__qrcode__logo';\n                        // qrcodeLogo.draggable = false;\n                        // qrcodeLogo.style.display = 'none';\n                        // qrcodeLogo.style.borderRadius = '50%';\n                        // 这里设置宽高没啥意义，不设置可能会导致 safari 报错\n                        qrcodeLogo.width = size.width / 2.4;\n                        qrcodeLogo.height = size.height / 2.4;\n                        // // 计算得到 offset 数值\n                        // let containerHalfWidth = size.width / 2;\n                        // let containerHalfHeight = size.height / 2;\n                        // let logoHalfWidth = qrcodeLogo.width / 2;\n                        // let logoHalfHeight = qrcodeLogo.height / 2;\n                        // let offset = {\n                        //   x: containerHalfWidth - logoHalfWidth,\n                        //   y: containerHalfHeight - logoHalfHeight\n                        // };\n                        // createCssClassStyleSheet(\n                        //   'authing__qrcode__logo',\n                        //   `\n                        //     border-radius: 50%;\n                        //     position: absolute;\n                        //     left: ${offset.y}px;\n                        //     top: ${offset.x}px;\n                        //   `\n                        // );\n                        qrcodeLogo.onload = function () {\n                            qrcodeLogo.style.display = 'inline';\n                            resolve(qrcodeLogo);\n                        };\n                        qrcodeLogo.onerror = function () {\n                            resolve(qrcodeLogo);\n                        };\n                    });\n                };\n                genShadowMiddleStatus = function (text) {\n                    // prefix: 修改提示文字\n                    editTipText(middleTitle);\n                    // 1. 生成 successWrapper \n                    var successWrapper = document.createElement('div');\n                    createCssClassStyleSheet('__authing-shadow-inner-style-position', \"position:absolute;top:56%;left:50%;\\n         width:64px;transform:translate(-50%,-50%);\\n        background-position:center center;\\n      align-items: center; /*\\u5782\\u76F4\\u5C45\\u4E2D*/\\n      justify-content: center; /*\\u6C34\\u5E73\\u5C45\\u4E2D*/\");\n                    successWrapper.classList.add('__authing-shadow-inner-style-position');\n                    // 2. 创建图片节点\n                    var successImage = document.createElement('div');\n                    createCssClassStyleSheet('__authing-shadow-inner-image-style-position', \"width:64px;height:64px;opacity:1;\\n        background-position:center center;background-repeat:no-repeat;\\n        background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTQiIGhlaWdodD0iNTQiIHZpZXdCb3g9IjAgMCA1NCA1NCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTI3IDUzLjY2NjdDMTIuMjcyIDUzLjY2NjcgMC4zMzMzNzQgNDEuNzI4IDAuMzMzMzc0IDI3QzAuMzMzMzc0IDEyLjI3MiAxMi4yNzIgMC4zMzMzMzIgMjcgMC4zMzMzMzJDNDEuNzI4IDAuMzMzMzMyIDUzLjY2NjcgMTIuMjcyIDUzLjY2NjcgMjdDNTMuNjY2NyA0MS43MjggNDEuNzI4IDUzLjY2NjcgMjcgNTMuNjY2N1pNMjQuMzQxNCAzNy42NjY3TDQzLjE5NDcgMTguODEwN0wzOS40MjQgMTUuMDRMMjQuMzQxNCAzMC4xMjUzTDE2Ljc5NzQgMjIuNTgxM0wxMy4wMjY3IDI2LjM1MkwyNC4zNDE0IDM3LjY2NjdaIiBmaWxsPSIjMUVCNzZEIi8+Cjwvc3ZnPgo=);\\n        margin-bottom: 10px;\\n      align-items: center; /*\\u5782\\u76F4\\u5C45\\u4E2D*/\\n      justify-content: center; /*\\u6C34\\u5E73\\u5C45\\u4E2D*/\");\n                    successImage.classList.add('__authing-shadow-inner-image-style-position');\n                    successImage.id = 'authing_scan_success_image';\n                    // 3. 创建文字节点\n                    var successTextNode = document.createElement('p');\n                    createCssClassStyleSheet('__authing-shadow-inner-text-style-position', \"font-weight: 400;font-size: 14px;line-height: 20px;color: #282D3C;;align-items: center; /*\\u5782\\u76F4\\u5C45\\u4E2D*/justify-content: center; /*\\u6C34\\u5E73\\u5C45\\u4E2D*/\");\n                    successTextNode.classList.add('__authing-shadow-inner-text-style-position');\n                    successTextNode.id = 'authing_scan_success_text';\n                    successTextNode.innerText = text;\n                    successWrapper.appendChild(successImage);\n                    successWrapper.appendChild(successTextNode);\n                    return successWrapper;\n                };\n                genReferTextNode = function (text) {\n                    var referTextNode = document.createElement('p');\n                    createCssClassStyleSheet('__authing-shadow-inner-refer-text-style-position', \"color: #215AE5;font-size: 14px;line-height:20px;font-weight: 400; text-align:center;cursor:pointer;padding-top:4px;\");\n                    referTextNode.classList.add('__authing-shadow-inner-refer-text-style-position');\n                    referTextNode.id = 'authing_scan_success_refer_text';\n                    referTextNode.innerText = text;\n                    // 点击事件 TODO: 内置了方法封装 回头在处理下\n                    referTextNode.onclick = function () {\n                        if (_this.timer) {\n                            clearInterval(_this.timer);\n                        }\n                        if (onRetry) {\n                            onRetry();\n                        }\n                        start();\n                    };\n                    return referTextNode;\n                };\n                removeReferTextNode = function () {\n                    var id = 'authing_scan_success_refer_text';\n                    var dom = document.getElementById(id);\n                    if (dom) {\n                        dom.parentNode.removeChild(dom);\n                    }\n                };\n                genShadow = function (text, aOnClick, shadowAId) {\n                    var shadowId = 'authing__retry';\n                    if (document.getElementById(shadowId)) {\n                        document.getElementById(shadowId).remove();\n                    }\n                    var shadow = document.createElement('div');\n                    shadow.id = shadowId;\n                    createCssClassStyleSheet('__authing-shadow-style', \"text-align:center;width: \" + size.width + \"px;height: \" + size.height + \"px;position: absolute;left: 50%;top: 0px;margin-left: -\" + size.width /\n                        2 + \"px;background-color: rgba(0,0,0, 0.5);line-height:\" + size.height + \"px;color:#fff;font-weight:600;\");\n                    shadow.classList.add('__authing-shadow-style');\n                    var shadowA = document.createElement('a');\n                    shadowA.innerHTML = text;\n                    shadowA.style.color = '#fff';\n                    shadowA.style.borderBottom = '1px solid #fff';\n                    shadowA.style.cursor = 'pointer';\n                    if (aOnClick) {\n                        shadowA.addEventListener('click', aOnClick);\n                    }\n                    shadowA.id = shadowAId;\n                    shadow.appendChild(shadowA);\n                    return shadow;\n                };\n                displayScannedUser = function (_) {\n                    var shadowId = 'authing__retry';\n                    if (document.getElementById(shadowId)) {\n                        document.getElementById(shadowId).remove();\n                    }\n                    var shadow = document.createElement('div');\n                    // TODO: 获得 img 标签的大小，然后给赋给这招大小\n                    createCssClassStyleSheet('__authing-shadow-style-position', \"text-align:center;width:\" + size.width + \"px;height: \" + size.height + \"px;background:rgba(255,255,255,.97);position: absolute;left: 50%;top: 0px;margin-left: -\" + size.width /\n                        2 + \"px;line-height:\" + size.height + \"px;color:#fff;font-weight:600;display: flex;\\n      align-items: center; /*\\u5782\\u76F4\\u5C45\\u4E2D*/\\n      justify-content: center; /*\\u6C34\\u5E73\\u5C45\\u4E2D*/\");\n                    shadow.classList.add('__authing-shadow-style-position');\n                    shadow.id = shadowId;\n                    // 生成文字节点 如果是微信扫码不需要中间状\n                    var successWrapper = genShadowMiddleStatus(succeed);\n                    // 生成按钮节点\n                    var referTextNode = genReferTextNode(referText);\n                    nodeWrapper.appendChild(referTextNode);\n                    shadow.appendChild(successWrapper);\n                    return shadow;\n                };\n                start = function () { return __awaiter(_this, void 0, void 0, function () {\n                    var random, url, logo, data, error_1, qrcodeImage, qrcodeLogo, canvas, context2D, _a, x, y, ww, hh, base64, img, decoratedOnSuccess, decoratedOnScanned, decoratedOnCancel, decoratedOnExpired, decoratedOnError, tip, dom;\n                    var _this = this;\n                    return __generator(this, function (_b) {\n                        switch (_b.label) {\n                            case 0:\n                                loading();\n                                random = null;\n                                url = null;\n                                logo = null;\n                                _b.label = 1;\n                            case 1:\n                                _b.trys.push([1, 3, , 4]);\n                                return [4 /*yield*/, this.geneCode({\n                                        context: context,\n                                        customData: customData,\n                                        extIdpConnId: extIdpConnId,\n                                        withCustomData: withCustomData\n                                    })];\n                            case 2:\n                                data = _b.sent();\n                                random = data.random;\n                                url = data.url;\n                                logo = data.customLogo;\n                                return [3 /*break*/, 4];\n                            case 3:\n                                error_1 = _b.sent();\n                                error_1 = error_1;\n                                genRetry(node, error_1.message);\n                                if (onCodeLoadFailed) {\n                                    onCodeLoadFailed(error_1);\n                                }\n                                return [2 /*return*/];\n                            case 4:\n                                if (onCodeLoaded) {\n                                    onCodeLoaded(random, url);\n                                }\n                                nodeWrapper = document.createElement('div');\n                                nodeWrapper.id = 'authing__qrcode-wrapper';\n                                nodeWrapper.style.textAlign = 'center';\n                                nodeWrapper.style.position = 'relative';\n                                nodeWrapper.style.margin = 'auto';\n                                return [4 /*yield*/, genImage(url)];\n                            case 5:\n                                qrcodeImage = _b.sent();\n                                if (!logo) return [3 /*break*/, 7];\n                                return [4 /*yield*/, genLogoInCenter(logo)];\n                            case 6:\n                                qrcodeLogo = _b.sent();\n                                _b.label = 7;\n                            case 7:\n                                canvas = document.createElement('canvas');\n                                canvas.width = size.width;\n                                canvas.height = size.height;\n                                context2D = canvas.getContext('2d');\n                                url && context2D.drawImage(qrcodeImage, 0, 0, size.width, size.height);\n                                _a = getOffset(size), x = _a.x, y = _a.y, ww = _a.ww, hh = _a.hh;\n                                context2D.save();\n                                roundedImage(context2D, x, y, ww, hh, ww / 2);\n                                context2D.clip();\n                                try {\n                                    qrcodeLogo && context2D.drawImage(qrcodeLogo, x, y, ww, hh);\n                                }\n                                catch (_c) {\n                                    console.log('Draw stop, check qrcodeLogo', qrcodeLogo);\n                                }\n                                context2D.restore();\n                                try {\n                                    base64 = canvas.toDataURL();\n                                    img = document.createElement('img');\n                                    img.src = base64;\n                                    nodeWrapper.appendChild(img);\n                                }\n                                catch (_d) {\n                                    // base64 不可行，可能被浏览器拦截（同源策略）\n                                    // 直接绘制 canvas 并渲染，确保基本功能可用\n                                    nodeWrapper.appendChild(canvas);\n                                }\n                                unloading();\n                                if (onCodeShow) {\n                                    onCodeShow(random, url);\n                                }\n                                decoratedOnSuccess = function (userInfo, ticket) {\n                                    // prefix: 修改提示文字\n                                    editTipText('');\n                                    // 移除重新扫码DOM\n                                    removeReferTextNode();\n                                    var shadow = genShadow(succeed, null, '__authing_success_tip');\n                                    nodeWrapper.appendChild(shadow);\n                                    if (onSuccess) {\n                                        if (autoExchangeUserInfo) {\n                                            var token = userInfo.token;\n                                            if (!token) {\n                                                // 轮询接口不会返回完整用户信息，需要使用 ticket 换取\n                                                _this.exchangeUserInfo(ticket).then(function (userInfo) {\n                                                    // @ts-ignore\n                                                    _this.tokenProvider.setUser(userInfo);\n                                                    // @ts-ignore\n                                                    onSuccess(userInfo, ticket);\n                                                });\n                                            }\n                                            else {\n                                                onSuccess(userInfo, ticket);\n                                            }\n                                        }\n                                        else {\n                                            onSuccess(userInfo, ticket);\n                                        }\n                                    }\n                                };\n                                decoratedOnScanned = function (userInfo) {\n                                    var shadow = displayScannedUser(userInfo.nickname);\n                                    nodeWrapper.appendChild(shadow);\n                                    if (onScanned) {\n                                        onScanned(userInfo);\n                                    }\n                                };\n                                decoratedOnCancel = function () {\n                                    // 取消授权直接刷新二维码\n                                    if (start) {\n                                        start();\n                                    }\n                                    // const shadow = genShadow(canceled, null, '__authing_success_tip');\n                                    // nodeWrapper.appendChild(shadow);\n                                    if (onCancel) {\n                                        onCancel();\n                                    }\n                                };\n                                decoratedOnExpired = function () {\n                                    var shadow = genShadow(expired, function () {\n                                        nodeWrapper.innerHTML = '';\n                                        start();\n                                    }, '__authing_success_tip');\n                                    nodeWrapper.appendChild(shadow);\n                                    if (onExpired) {\n                                        onExpired();\n                                    }\n                                };\n                                decoratedOnError = function (data) {\n                                    var message = data.message;\n                                    if (onError) {\n                                        onError(message);\n                                    }\n                                };\n                                // 开始轮询\n                                this.startPolling(random, {\n                                    interval: interval,\n                                    onStart: onStart,\n                                    onResult: onResult,\n                                    onScanned: decoratedOnScanned,\n                                    onExpired: decoratedOnExpired,\n                                    onSuccess: decoratedOnSuccess,\n                                    onCancel: decoratedOnCancel,\n                                    onError: decoratedOnError,\n                                    onMfa: onMfa,\n                                    onAuthFlow: onAuthFlow\n                                });\n                                tip = genTip(title);\n                                nodeWrapper.appendChild(tip);\n                                dom = document.querySelector('#authing__qrcode-wrapper');\n                                if (dom)\n                                    dom.remove();\n                                node.appendChild(nodeWrapper);\n                                return [2 /*return*/];\n                        }\n                    });\n                }); };\n                start();\n                return [2 /*return*/];\n            });\n        });\n    };\n    /**\n     * @name geneCode\n     * @name_zh 生成二维码\n     * @description 生成二维码\n     *\n     * @example\n     * const authenticationClient = new AuthenticationClient({\n     *    appId: \"YOUR_APP_ID\",\n     * })\n     * const { url, random } = await authenticationClient.wxqrcode.geneCode()\n     *\n     * # random 二维码唯一 ID\n     * # url 二维码链接\n     *\n     * @returns {Promise<QRCodeGenarateResult>}\n     * @memberof QrCodeAuthenticationClient\n     */\n    QrCodeAuthenticationClient.prototype.geneCode = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, context, customData, extIdpConnId, withCustomData, api, data;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = options || {}, context = _a.context, customData = _a.customData, extIdpConnId = _a.extIdpConnId, withCustomData = _a.withCustomData;\n                        api = this.baseClient.appHost + \"/api/v2/qrcode/gene\";\n                        return [4 /*yield*/, this.httpClient.request({\n                                method: 'POST',\n                                url: api,\n                                data: {\n                                    autoMergeQrCode: false,\n                                    scene: this.scene,\n                                    context: context,\n                                    params: customData,\n                                    extIdpConnId: extIdpConnId,\n                                    withCustomData: withCustomData\n                                }\n                            })];\n                    case 1:\n                        data = _b.sent();\n                        return [2 /*return*/, data];\n                }\n            });\n        });\n    };\n    /**\n     * @name checkStatus\n     * @name_zh 检测扫码状态\n     * @description 检测扫码状态\n     *\n     * @param {string} random\n     *\n     * @example\n     *\n     * const authenticationClient = new AuthenticationClient({\n     *    appId: \"YOUR_APP_ID\",\n     * })\n     * const { random, status, ticket, userInfo } = await authenticationClient.wxqrcode.checkStatus('RANDOM')\n     * # status: 二维码状态: 0 - 未使用, 1 - 已扫码, 2 - 已授权, 3 - 取消授权, -1 - 已过期\n     * # ticket: 用于换取用户信息的一个随机字符串\n     * # userInfo: 用户信息\n     *\n     * @returns {Promise<QRCodeStatus>}\n     * @memberof QrCodeAuthenticationClient\n     */\n    QrCodeAuthenticationClient.prototype.checkStatus = function (random) {\n        return __awaiter(this, void 0, void 0, function () {\n            var api, data;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        api = this.baseClient.appHost + \"/api/v2/qrcode/check?random=\" + random;\n                        return [4 /*yield*/, this.httpClient.request({\n                                method: 'GET',\n                                url: api\n                            })];\n                    case 1:\n                        data = _a.sent();\n                        return [2 /*return*/, data];\n                }\n            });\n        });\n    };\n    /**\n     * @name exchangeUserInfo\n     * @name_zh 使用 ticket 交换用户信息\n     * @description 使用 ticket 交换用户信息\n     *\n     * @example\n     *\n     * const authenticationClient = new AuthenticationClient({\n     *    appId: \"YOUR_APP_ID\",\n     * })\n     * const user = await authenticationClient.wxqrcode.exchangeUserInfo('TICKET')\n     * # user: 完整的用户信息，其中 user.token 为用户的登录凭证。\n     *\n     * @param {string} ticket ticket\n     * @returns {Promise<Partial<User>>}\n     * @memberof QrCodeAuthenticationClient\n     */\n    QrCodeAuthenticationClient.prototype.exchangeUserInfo = function (ticket) {\n        return __awaiter(this, void 0, void 0, function () {\n            var api, userInfo;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        api = this.baseClient.appHost + \"/api/v2/qrcode/userinfo\";\n                        return [4 /*yield*/, this.httpClient.request({\n                                method: 'POST',\n                                url: api,\n                                data: {\n                                    ticket: ticket\n                                }\n                            })];\n                    case 1:\n                        userInfo = _a.sent();\n                        return [2 /*return*/, userInfo];\n                }\n            });\n        });\n    };\n    /**\n     * @name startPolling\n     * @name_zh 开始轮询二维码状态\n     * @description 开始轮询二维码状态\n     *\n     * @param {string} random 二维码唯一 ID\n     * @param {Object} options\n     * @param {number} options.interval 间隔时间，单位为毫秒，默认为 800 毫秒\n     * @param {Function} options.onStart 开始轮询的事件回调函数, 第一个参数为 setInterval 返回的计时器，可以用 clearInterval 取消此计时器\n     * @param {Function} options.onResult 获取到二维码最新状态事件回调函数，第一个参数为的类型为 QRCodeStatus。\n     * @param {Function} options.onScanned 用户首次扫码事件回调函数。此时用户还没有授权，回调的用户信息中通仅包含昵称和头像，用作展示目的。\n     * 出于安全性考虑，默认情况下，userInfo 只会包含昵称（nickname）和头像（photo）两个字段，开发者也可以在后台配置使其返回完整用户信息，\n     * @param {Function} options.onSuccess 用户同意授权事件回调函数。该函数只会回调一次，之后轮询结束。第一个参数为 userInfo 用户信息，第二个参数为 ticket，用于换取用户的详情。\n     * 详情见 https://docs.authing.co/scan-qrcode/app-qrcode/customize.html。\n     * ticket 可以用来换取完整的用户信息，相关接口见 https://docs.authing.co/scan-qrcode/app-qrcode/full-api-list.html。\n     * @param {Function} options.onCancel 用户取消授权事件回调函数。该事件只会回调一次，之后轮询结束。\n     * @param {Function} options.onError 获取二维码状态失败事件回调函数。常见原因为网络失败等，每次查询失败时都会回调。回调参数 data 示例如 {\"code\": 2241,\"message\": \"二维码不存在\" }\n     * @param {Function} options.onExpired 二维码失效时被回调，只回调一次，之后轮询结束。\n     *\n     * @returns {null}\n     * @memberof QrCodeAuthenticationClient\n     */\n    QrCodeAuthenticationClient.prototype.startPolling = function (random, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, interval, onStart, onResult, onScanned, onExpired, onSuccess, onCancel, onError, onMfa, onAuthFlow, calledOnScanned, callOnPoolingStart, timer;\n            var _this = this;\n            return __generator(this, function (_b) {\n                options = options || {};\n                _a = options.interval, interval = _a === void 0 ? 800 : _a, onStart = options.onStart, onResult = options.onResult, onScanned = options.onScanned, onExpired = options.onExpired, onSuccess = options.onSuccess, onCancel = options.onCancel, onError = options.onError, onMfa = options.onMfa, onAuthFlow = options.onAuthFlow;\n                calledOnScanned = false;\n                callOnPoolingStart = false;\n                timer = this.timer = setInterval(function () { return __awaiter(_this, void 0, void 0, function () {\n                    var data, status_1, ticket, userInfo, scannedResult, code, message, mfaData, scannedResult, scannedResult, errmsg, error_2;\n                    return __generator(this, function (_a) {\n                        switch (_a.label) {\n                            case 0:\n                                // 开始轮询时回调 onPollingStart\n                                if (onStart && !callOnPoolingStart) {\n                                    onStart(timer);\n                                    callOnPoolingStart = true;\n                                }\n                                _a.label = 1;\n                            case 1:\n                                _a.trys.push([1, 3, , 4]);\n                                return [4 /*yield*/, this.checkStatus(random)];\n                            case 2:\n                                data = _a.sent();\n                                status_1 = data.status, ticket = data.ticket, userInfo = data.userInfo;\n                                // 每次获取到数据都回调 onResult 函数\n                                if (onResult) {\n                                    onResult(data);\n                                }\n                                // 过期\n                                if (status_1 === -1) {\n                                    clearInterval(timer);\n                                    if (onExpired) {\n                                        onExpired();\n                                    }\n                                }\n                                // 未扫码\n                                if (status_1 === 0) {\n                                }\n                                // 已扫码\n                                if (status_1 === 1) {\n                                    if (onScanned && !calledOnScanned) {\n                                        onScanned(userInfo);\n                                        calledOnScanned = true;\n                                    }\n                                }\n                                // 已授权\n                                if (status_1 === 2) {\n                                    clearInterval(timer);\n                                    if (onSuccess) {\n                                        onSuccess(userInfo, ticket);\n                                    }\n                                }\n                                // 已取消\n                                if (status_1 === 3) {\n                                    clearInterval(timer);\n                                    if (onCancel) {\n                                        onCancel();\n                                    }\n                                }\n                                // 需要 MFA\n                                if (status_1 === 4) {\n                                    clearInterval(timer);\n                                    if (onMfa) {\n                                        scannedResult = data.scannedResult;\n                                        code = scannedResult.code, message = scannedResult.message, mfaData = scannedResult.data;\n                                        onMfa(code, message, mfaData);\n                                    }\n                                    if (onAuthFlow) {\n                                        scannedResult = data.scannedResult;\n                                        onAuthFlow(scannedResult);\n                                    }\n                                }\n                                // 未知错误\n                                if (status_1 === 5) {\n                                    clearInterval(timer);\n                                    if (onError) {\n                                        scannedResult = data.scannedResult;\n                                        errmsg = scannedResult.errmsg;\n                                        onError(errmsg);\n                                    }\n                                }\n                                return [3 /*break*/, 4];\n                            case 3:\n                                error_2 = _a.sent();\n                                if (onError) {\n                                    onError(error_2);\n                                }\n                                clearInterval(timer);\n                                return [2 /*return*/];\n                            case 4: return [2 /*return*/];\n                        }\n                    });\n                }); }, interval);\n                return [2 /*return*/, timer];\n            });\n        });\n    };\n    QrCodeAuthenticationClient.prototype.stopPolling = function (timer) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                clearInterval(timer);\n                return [2 /*return*/];\n            });\n        });\n    };\n    return QrCodeAuthenticationClient;\n}());\nexport { QrCodeAuthenticationClient };\n//# sourceMappingURL=QrCodeAuthenticationClient.js.map"]},"metadata":{},"sourceType":"module"}